<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ blog.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"><!--移动端适配-->
    <link href="https://cdn.bootcss.com/normalize/8.0.1/normalize.min.css" rel="stylesheet"><!--统一浏览器格式-->
    <link rel="stylesheet" href="/static/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/mystyle.css">
    <script src="/static/jquery-3.4.1.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        canvas {
            position: fixed;
            z-index: -2;
            width: 100%;
            height: 100%;
            margin-bottom: 0px;
        }

        .mynav {
            height: 50px;
            width: 100%;
            padding-right: 10%;
            font-weight: bolder;
            margin-bottom: 2%;
        }

        .mynav > ul > li > a {
            color: white;
        }

        #blog-header {
            width: 100%;
            display: block;
            padding: 25px;
        }

        #blogTitle h1 {
            font-size: 30px;
            font-weight: bold;
            line-height: 1.5em;
        }

        #blogTitle h1 a:hover {
            color: #f60;
            text-decoration: none;
        }

        #blogTitle h1 a {
            font-family: "Comic Sans MS";
            color: #eeeeee;
        }

        #blog-right p a {
            color: #2B2E33;
        }

        #blog-right p a:hover {
            color: #f60;
            text-decoration: none;
        }
    </style>
</head>
<body>
<canvas></canvas>
<div id="blog-header">
    <div id="blogTitle">
        <h1><a href="/blog/{{ username }}/">{{ blog.title }}</a></h1>
    </div>
</div>
<div class="mynav">
    <ul class="nav nav-pills pull-right">
        <li role="presentation"><a href="/index/">博客园</a></li>
        <li role="presentation"><a href="/blog/{{ username }}/">首页</a></li>
        <li role="presentation"><a href="/blog/backend/add_article/">新文章</a></li>
        <li role="presentation"><a href="#">联系我们</a></li>
        <li role="presentation"><a href="/blog/backend/article_list/">管理</a></li>
    </ul>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="panel panel-default" style="opacity: 0.9;overflow: auto">
                <div class="panel panel-body">  {% block page-main %}
                {% endblock %}</div>
            </div>

            <!--个人博客列表-->

            <!--个人博客列表-->

        </div>
        <div class="col-md-3 pull-right" id="blog-right">
            <div class="panel panel-default">
                <div class="panel-heading">文章分类</div>
                <div class="panel-body">
                    {#得到文章分类和分类下的文章数#}
                    {% for categroy in category_list %}
                        <p><span><a
                                href="/blog/{{ username }}/category/{{ categroy.title }}/">{{ categroy.title }}({{ categroy.article_set.all.count }})</a></span>
                        </p>
                    {% endfor %}
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">文章标签</div>
                <div class="panel-body">
                    {#得到文章分类和分类下的文章数#}
                    {% for tag in tag_list %}
                        <p><span><a  href="/blog/{{ username }}/tag/{{ tag.title }}/">{{ tag.title }}({{ tag.c }})</a></span></p>
                    {% endfor %}
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">日期归档</div>
                <div class="panel-body">
                    {#得到文章分类和分类下的文章数#}
                    {% for a in archive_list %}
                        <p><span><a href="/blog/{{ username }}/archive/{{ a.archive_ym }}/">{{ a.archive_ym }}({{ a.c }})</a></span></p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

</div>


<script src="/static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script>
    var canvas, ctx, width, height, stems, bubbles;

    stems = [];
    bubbles = [];

    function Bubble(x, y, radius) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.vy = -Math.random() * 5;
        this.opacity = 0.2 + Math.random() * 0.5;
        this.oldY = y;
    }

    Bubble.prototype.draw = function () {
        var strokeColor, fillColor;

        strokeColor = 'rgba(255, 255, 255,' + this.opacity + ')';
        fillColor = 'rgba(255, 255, 255,' + (this.opacity / 2) + ')';

        ctx.save();
        ctx.lineWidth = 0.8;
        ctx.strokeStyle = strokeColor;
        ctx.fillStyle = fillColor;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        ctx.restore();
    }

    function Stem(points, color) {
        this.points = points;
        this.color = color;
    }

    Stem.prototype.draw = function (ctx) {
        var len, ctrlPoint, point;

        len = this.points.length - 1;
        ctrlPoint = {x: 0, y: 0};

        ctx.save();
        ctx.strokeStyle = this.color;
        ctx.beginPath();
        ctx.moveTo(this.points[this.points.length - 1].x, this.points[this.points.length - 1].y);
        for (var i = len; i >= 1; i--) {
            point = this.points[i];
            ctrlPoint.x = (point.x + this.points[i - 1].x) / 2;
            ctrlPoint.y = (point.y + this.points[i - 1].y) / 2;
            ctx.quadraticCurveTo(point.x, point.y, ctrlPoint.x, ctrlPoint.y);
            ctx.lineWidth = i * 1.1;
            ctx.stroke();
            ctx.fillStyle = 'red';
        }
        ctx.restore();
    }

    init();

    function init() {
        canvas = document.querySelector('canvas');
        ctx = canvas.getContext('2d');
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;

        populateStems(height / 3, width, 25);
        generateBubbles(50);

        drawFrame();
    };

    function generateBubbles(bubblesLimit) {
        for (var i = 0; i <= bubblesLimit; i++) {
            bubbles.push(new Bubble(Math.random() * width, height + Math.random() * height / 2, 2 + Math.random() * 2));
        }
    }

    function populateStems(offset, limit, step) {
        for (var x = 0; x <= limit; x += step) {
            generateStem(x, height / 2 - offset / 2 + Math.random() * offset, 50)
        }
    }

    function generateStem(x, pointsLen, step) {
        var positions, y, offset, colorsArr, color;

        colorsArr = ['#6e881b', '#5d7314', '#54690f', '#657f0f', '#6f8f06'];
        color = Math.floor(1 + Math.random() * colorsArr.length - 1);
        positions = [];

        if (height < 600) {
            offset = -40 + Math.random() * 80;
            for (y = height - pointsLen; y <= height + 100; y += step / 2) {
                positions.push({
                    x: x + offset / (y / 2000),
                    y: y,
                    angle: Math.random() * 360,
                    speed: 0.1 + Math.random() * 0.3
                });
            }
        } else {
            offset = -100 + Math.random() * 200;
            for (y = height - pointsLen; y <= height + 100; y += step) {
                positions.push({
                    x: x + offset / (y / 2000),
                    y: y,
                    angle: Math.random() * 360,
                    speed: 0.1 + Math.random() * 0.3
                });
            }
        }
        stems.push(new Stem(positions, colorsArr[color]));
    }

    function drawFrame() {
        window.requestAnimationFrame(drawFrame, canvas);
        ctx.fillStyle = '#17293a';
        ctx.fillRect(0, 0, width, height);
        bubbles.forEach(moveBubble);
        stems.forEach(function (stem) {
            stem.points.forEach(movePoint);
            stem.draw(ctx);
        });
    }

    function moveBubble(bubble) {
        if (bubble.y + bubble.radius <= 0) bubble.y = bubble.oldY;
        bubble.y += bubble.vy;
        bubble.draw(ctx);
    }

    function movePoint(point, index) {
        point.x += Math.sin(point.angle) / (index / 2.2);
        point.angle += point.speed;
    }
</script>
</body>
</html>